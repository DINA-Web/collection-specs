# Common query parameters for all DINA APIs
# Reference this file using: $ref: './components/common-parameters.yml#/FiqlFilter'

FiqlFilter:
  name: fiql
  in: query
  required: false
  description: |
    **FIQL (Feed Item Query Language) filter for querying resources.**
    
    FIQL provides a URI-friendly syntax for expressing filters. This parameter is supported
    across most DINA collection APIs for consistent querying. FIQL cannot be applied to nested fields.
    <details>
    <summary><strong>Comparison Operators</strong></summary>
    
    | Operator | Syntax | Description | Example |
    |----------|--------|-------------|---------|
    | Equal | `==` | Exact match | `catalogNumber==ABC123` |
    | Not Equal | `!=` | Does not match | `status!=archived` |
    | Greater Than | `=gt=` | Numeric/date comparison | `year=gt=2020` |
    | Greater or Equal | `=ge=` | Inclusive comparison | `count=ge=10` |
    | Less Than | `=lt=` | Numeric/date comparison | `year=lt=2025` |
    | Less or Equal | `=le=` | Inclusive comparison | `count=le=100` |
    | In | `=in=()` | Value in list | `status=in=(active,pending)` |
    | Out | `=out=()` | Value not in list | `type=out=(draft,archived)` |
    </details>
    
    <details>
    <summary><strong>Logical Operators</strong></summary>
    
    | Operator | Syntax | Description | Example |
    |----------|--------|-------------|---------|
    | AND | `;` | Both conditions must be true | `name==John;age=gt=25` |
    | OR | `,` | Either condition can be true | `status==active,status==pending` |
    | Grouping | `()` | Group conditions | `(field1==a,field1==b);field2==c` |
    
    </details>
    
    <details>
    <summary><strong>Wildcards</strong></summary>
    
    - `*` - Matches zero or more characters
    - `?` - Matches exactly one character
    
    **Examples:**
    - `name==John*` - Starts with "John"
    - `name==*Smith` - Ends with "Smith"
    - `name==*John*` - Contains "John"
    - `code==A?C` - A, any single character, then C
    
    </details>
    
    <details>
    <summary><strong>Query Examples</strong></summary>
    
    
    ### Simple Queries
    ```
    catalogNumber==ABC123
    scientificName==Quercus robur
    collectionYear==2023
    ```
    
    ### Wildcard Searches
    ```
    scientificName==*Quercus*
    commonName==*oak*
    locality==*Canada*
    ```
    
    ### Numeric Comparisons
    ```
    collectionYear=gt=2020
    specimenCount=ge=10
    latitude=lt=45.5
    ```
    
    ### Date Ranges
    ```
    collectedDate=ge=2020-01-01;collectedDate=le=2024-12-31
    modifiedDate=gt=2024-01-01
    ```
    
    ### Multiple Values
    ```
    status=in=(active,pending,review)
    collectionCode=in=(BOTANY,ZOOLOGY,GEOLOGY)
    preparationType=out=(deleted,archived)
    ```
    
    ### Combined Conditions (AND)
    ```
    scientificName==*Quercus*;collectionYear=gt=2020
    status==active;preparationType==mounted;collectionYear=ge=2023
    ```
    
    ### Combined Conditions (OR)
    ```
    status==active,status==pending
    scientificName==*Quercus robur*,scientificName==*Quercus petraea*
    ```
    
    ### Complex Queries with Grouping
    ```
    (scientificName==*Quercus*,commonName==*oak*);collectionYear=gt=2020
    (status==active,status==pending);preparationType!=digital;collectionYear=ge=2023
    ```
    
    </details>
    
    <details><summary><strong>Important Notes</strong></summary>
    
    1. **URL Encoding**: Special characters must be URL-encoded in actual requests
       - Space: `%20`
       - `;` (AND): `%3B`
       - `,` (OR): `%2C`
    
    2. **Case Sensitivity**: 
       - Field names are case-sensitive
       - String values are typically case-insensitive (implementation-dependent)
    
    3. **Performance**: Leading wildcards (`*term`) may impact query performance
    
    4. **Field Support**: Not all fields support all operators. See endpoint-specific documentation.
    
    </details>
    
  schema:
    type: string

# Simple Search Filter - Key-value based filtering
# Format: filter[field.subfield][OPERATOR]=value
SimpleSearchFilter:
  name: filter
  in: query
  required: false
  style: deepObject
  explode: true
  description: |
    **Simple search filter using key-value pairs with nested properties.**
    
    Filter results by specifying field paths and comparison operators.
    
    <details>
    <summary><strong>Filter Syntax</strong></summary>
    
    ```
    filter[fieldName][OPERATOR]=value
    ```
    
    </details>
    
    <details>
    <summary><strong>Supported Operators</strong></summary>
    
    | Operator | Description | Example |
    |----------|-------------|---------|
    | `NEQ` | Not equal to | `filter[status][NEQ]=archived` |
    | `EQ` | Equal to | `filter[status][EQ]=active` |
    | `GT` | Greater than | `filter[age][GT]=18` |
    | `LT` | Less than | `filter[age][LT]=65` |
    | `IN` | In list (comma-separated) | `filter[status][IN]=active,pending` |
    | `LIKE` | Pattern match (use % for wildcard) | `filter[name][LIKE]=%oak%` |
    | `ILIKE` | Case-insensitive pattern match (use % for wildcard) | `filter[locality][ILIKE]=%canada%` |
    
    </details>
    
    <details>
    <summary><strong>Examples</strong></summary>
    
    ### Simple Equality
    ```
    filter[catalogNumber][EQ]=ABC123
    filter[status][EQ]=active
    ```
    
    ### Nested Properties
    ```
    filter[storageUnitType.uuid][EQ]=0193bc05-5d49-7b99-89ea-7c97d2dcd7bd
    filter[collection.code][EQ]=BOTANY
    filter[determination.scientificName][LIKE]=%Quercus%
    ```
    
    ### Numeric Comparisons
    ```
    filter[collectionYear][GTE]=2020
    filter[specimenCount][LT]=100
    filter[latitude][GT]=45.5
    ```
    
    ### Multiple Values (IN operator)
    ```
    filter[status][IN]=active,pending,review
    filter[collectionCode][IN]=BOTANY,ZOOLOGY
    ```
    
    ### Pattern Matching
    ```
    filter[scientificName][LIKE]=%Quercus%
    filter[locality][ILIKE]=%canada%
    ```

    ### Wildcard Searches
    ```
    filter[scientificName][LIKE]=%Quercus // matches any name ending with "Quercus"
    filter[scientificName][LIKE]=Quercus% // matches any name starting with "Quercus"
    filter[scientificName][LIKE]=Quercus% // matches any name containing "Quercus"
    ```
    
    ### Multiple Filters (AND logic)
    ```
    filter[status][EQ]=active&filter[collectionYear][GTE]=2020
    filter[storageUnitType.uuid][EQ]=abc123&filter[preparationType][EQ]=mounted
    ```
    
    ### OR Logic within a Single Filter
    ```
    filter[status][IN]=active,pending
    filter[scientificName][LIKE]=%Quercus%,%Pinus%
    ```

    </details>

    <details>
    
    <summary><strong>Nested Property Paths</strong></summary>
    
    Use dot notation to filter on nested/related objects:
    
    ```
    filter[relationship.property][OPERATOR]=value
    filter[parent.child][OPERATOR]=value
    filter[parent.child.grandchild][OPERATOR]=value
    ```
    
    </details>

    <details>
    <summary><strong>Important Notes</strong></summary>
    
    1. **Multiple Filters**: Use `&` to combine multiple filters (AND logic) and use `,` for OR logic in the same filter
        Note: OR logic cannot be applied across multiple filter parameters
    2. **URL Encoding**: Special characters must be URL-encoded
       - Space: `%20`
       - `%` wildcard: `%25` (for LIKE patterns)
    3. **Case Sensitivity**: Field names are case-sensitive
    4. **Operator Format**: Operators must be in UPPERCASE
    5. **Wildcards**: Use `%` for wildcards in LIKE/ILIKE patterns
    
    </details>
    
    <details>
    <summary><strong>URL-Encoded Examples</strong></summary>
    
    ```
    # Before encoding:
    filter[storageUnitType.uuid][EQ]=0193bc05-5d49-7b99-89ea-7c97d2dcd7bd
    
    # After encoding:
    filter%5BstorageUnitType.uuid%5D%5BEQ%5D=0193bc05-5d49-7b99-89ea-7c97d2dcd7bd
    ```
    
    ```
    # Before encoding:
    filter[scientificName][LIKE]=%Quercus%
    
    # After encoding:
    filter%5BscientificName%5D%5BLIKE%5D=%25Quercus%25
    ```
    </details>
    
  schema:
    type: object
    additionalProperties:
      type: object
      additionalProperties:
        type: string

Sort:
  in: query
  name: sort
  description: optional sort order string, such as descending, denoted by "-"
  schema:
    type: string

PageOffset:
  in: query
  name: page[offset]
  description: number of records to skip when paging
  schema:
    type: integer
    format: int32

PageLimit:
  in: query
  name: page[limit]
  description: maximum number of records to return when paging
  schema:
    type: integer
    format: int32
    minimum: 0
    maximum: 50

Attachment:
  type: object
  nullable: true
  properties:
    data:
      type: array
      items:
        type: object
        required:
          - type
          - id
        properties:
          type: 
            type: string
            example: metadata
          id:
            type: string
            format: uuid
            description: Unique identifier metadata for the resource
            example: 8f68a05f-937d-4d40-88b4-ed92720d9c3f



  